# –ü–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ ‚Äî Search Engine

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–§–∏–ª–æ—Å–æ—Ñ–∏—è –∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã](#1-—Ñ–∏–ª–æ—Å–æ—Ñ–∏—è-–∏-–ø—Ä–∏–Ω—Ü–∏–ø—ã)
2. [–§–∞–∑–∞ 0: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ baseline](#2-—Ñ–∞–∑–∞-0-–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-–∏-baseline)
3. [–§–∞–∑–∞ 1: –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–∏–ø–æ–≤ (lib.rs ‚Üî main.rs)](#3-—Ñ–∞–∑–∞-1-—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ-–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è-—Ç–∏–ø–æ–≤)
4. [–§–∞–∑–∞ 2: –°—Ç–∞–±–∏–ª—å–Ω–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—É—Ç–µ–π –∏–Ω–¥–µ–∫—Å–æ–≤](#4-—Ñ–∞–∑–∞-2-—Å—Ç–∞–±–∏–ª—å–Ω–æ–µ-—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ-–ø—É—Ç–µ–π-–∏–Ω–¥–µ–∫—Å–æ–≤)
5. [–§–∞–∑–∞ 3: –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (unwrap ‚Üí Result)](#5-—Ñ–∞–∑–∞-3-–±–µ–∑–æ–ø–∞—Å–Ω–∞—è-–æ–±—Ä–∞–±–æ—Ç–∫–∞-–æ—à–∏–±–æ–∫)
6. [–§–∞–∑–∞ 4: –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–∏–ø –æ—à–∏–±–æ–∫ SearchError](#6-—Ñ–∞–∑–∞-4-—Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π-—Ç–∏–ø-–æ—à–∏–±–æ–∫)
7. [–§–∞–∑–∞ 5: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (total_tokens)](#7-—Ñ–∞–∑–∞-5-–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å-–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
8. [–§–∞–∑–∞ 6: –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ process::exit –≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ](#8-—Ñ–∞–∑–∞-6-—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ-processexit)
9. [–§–∞–∑–∞ 7: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∑–∞–ø–∏—Å–∏ –≤ MCP —Å–µ—Ä–≤–µ—Ä–µ](#9-—Ñ–∞–∑–∞-7-–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è-–æ–±—Ä–∞–±–æ—Ç–∫–∞-–æ—à–∏–±–æ–∫-–∑–∞–ø–∏—Å–∏-–≤-mcp-—Å–µ—Ä–≤–µ—Ä–µ)
10. [–§–∞–∑–∞ 8: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ç—Ä–µ–π—Ç–æ–≤ –¥–ª—è DefinitionKind](#10-—Ñ–∞–∑–∞-8-—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ-—Ç—Ä–µ–π—Ç—ã-–¥–ª—è-definitionkind)
11. [–§–∞–∑–∞ 9: –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥–≤–æ–π–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –≤ phrase search](#11-—Ñ–∞–∑–∞-9-—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ-–¥–≤–æ–π–Ω–æ–≥–æ-—á—Ç–µ–Ω–∏—è-—Ñ–∞–π–ª–æ–≤)
12. [–§–∞–∑–∞ 10: –†–∞–∑–±–∏–µ–Ω–∏–µ main.rs –Ω–∞ –º–æ–¥—É–ª–∏](#12-—Ñ–∞–∑–∞-10-—Ä–∞–∑–±–∏–µ–Ω–∏–µ-mainrs-–Ω–∞-–º–æ–¥—É–ª–∏)
13. [–§–∞–∑–∞ 11: –ú–µ–ª–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è (clippy, style, #[must_use])](#13-—Ñ–∞–∑–∞-11-–º–µ–ª–∫–∏–µ-—É–ª—É—á—à–µ–Ω–∏—è)
14. [–ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏](#14-–ø–æ—Ä—è–¥–æ–∫-–≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è-–∏-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
15. [–ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ–∞–∑—ã](#15-—á–µ–∫–ª–∏—Å—Ç-–¥–ª—è-–∫–∞–∂–¥–æ–π-—Ñ–∞–∑—ã)

---

## 1. –§–∏–ª–æ—Å–æ—Ñ–∏—è –∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã

**–ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ: –∫–∞–∂–¥–∞—è —Ñ–∞–∑–∞ ‚Äî —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–º–º–∏—Ç (–∏–ª–∏ PR), –ø–æ—Å–ª–µ –∫–æ—Ç–æ—Ä–æ–≥–æ:**

- `cargo build` –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- `cargo test` –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é (0 failures)
- `cargo clippy` –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–æ–≤—ã—Ö warnings
- `cargo bench` –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è (–±–µ–Ω—á–º–∞—Ä–∫–∏ –Ω–µ –ª–æ–º–∞—é—Ç—Å—è)

**–ü–æ—Ä—è–¥–æ–∫ —Ñ–∞–∑ –≤—ã–±—Ä–∞–Ω –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É:**

1. –°–Ω–∞—á–∞–ª–∞ ‚Äî —Ç–æ, —á—Ç–æ –≤–ª–∏—è–µ—Ç –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å (–±–∞–≥–∏, –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö)
2. –ó–∞—Ç–µ–º ‚Äî —Ç–æ, —á—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–∞–Ω–∏–∫—É –≤ —Ä–∞–Ω—Ç–∞–π–º–µ
3. –ó–∞—Ç–µ–º ‚Äî –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
4. –í –∫–æ–Ω—Ü–µ ‚Äî —Å—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–ö–∞–∂–¥–∞—è —Ñ–∞–∑–∞ –≤–∫–ª—é—á–∞–µ—Ç:**

- –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
- –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ—à–µ–Ω–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å)
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Å –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ–º
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —à–∞–≥–∏
- –ù–æ–≤—ã–µ —Ç–µ—Å—Ç—ã
- –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

---

## 2. –§–∞–∑–∞ 0: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ baseline

### –¶–µ–ª—å

–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, —á—Ç–æ–±—ã –∏–º–µ—Ç—å –Ω–∞–¥—ë–∂–Ω—É—é —Ç–æ—á–∫—É –æ—Ç–∫–∞—Ç–∞.

### –®–∞–≥–∏

1. **–°–æ–∑–¥–∞—Ç—å –≤–µ—Ç–∫—É `refactor/baseline`**
2. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
   ```powershell
   cargo build 2>&1 | Tee-Object -FilePath baseline-build.log
   cargo test 2>&1 | Tee-Object -FilePath baseline-test.log
   cargo clippy 2>&1 | Tee-Object -FilePath baseline-clippy.log
   cargo bench --no-run 2>&1 | Tee-Object -FilePath baseline-bench-compile.log
   ```
3. **–ó–∞–ø–∏—Å–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤ –∏ –∏—Ö —Å—Ç–∞—Ç—É—Å—ã** –≤ —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç (–∑–∞–ø–æ–ª–Ω–∏—Ç—å –Ω–∏–∂–µ)
4. **–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç.** –ï—Å–ª–∏ –µ—Å—Ç—å failing —Ç–µ—Å—Ç—ã ‚Äî –ø–æ—á–∏–Ω–∏—Ç—å –∏—Ö –î–û –Ω–∞—á–∞–ª–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

### Baseline (–∑–∞–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏)

| –ú–µ—Ç—Ä–∏–∫–∞                     | –ó–Ω–∞—á–µ–Ω–∏–µ          |
| --------------------------- | ----------------- |
| `cargo build`               | ‚¨ú OK / ‚¨ú –û—à–∏–±–∫–∏ |
| `cargo test` ‚Äî –≤—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤ | ‚¨ú \_\_\_         |
| `cargo test` ‚Äî passed       | ‚¨ú \_\_\_         |
| `cargo test` ‚Äî failed       | ‚¨ú \_\_\_         |
| `cargo clippy` ‚Äî warnings   | ‚¨ú \_\_\_         |
| `cargo bench --no-run`      | ‚¨ú OK / ‚¨ú –û—à–∏–±–∫–∏ |

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

- –í—Å–µ 4 –∫–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- –õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

---

## 3. –§–∞–∑–∞ 1: –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–∏–ø–æ–≤

### –ü—Ä–æ–±–ª–µ–º–∞

`Posting`, `ContentIndex`, `clean_path()`, `tokenize()` –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã **–¥–≤–∞–∂–¥—ã** ‚Äî –≤ `src/lib.rs` –∏ –≤ `src/main.rs`. –ë–µ–Ω—á–º–∞—Ä–∫–∏ –∏ doctests –∏—Å–ø–æ–ª—å–∑—É—é—Ç –≤–µ—Ä—Å–∏—é –∏–∑ `lib.rs`, –∞ –≤–µ—Å—å runtime ‚Äî –≤–µ—Ä—Å–∏—é –∏–∑ `main.rs`. –≠—Ç–æ –¥–≤–∞ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–∞ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –∏–º–µ–Ω–∞–º–∏. –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –Ω–µ–∏–∑–±–µ–∂–Ω–æ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ –±–∞–≥–∞–º.

### –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ—à–µ–Ω–∏—è

#### –í–∞—Ä–∏–∞–Ω—Ç A: main.rs –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –∏–∑ lib.rs (‚≠ê –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)

**–°—É—Ç—å:** –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏–∑ `main.rs`, –¥–æ–±–∞–≤–∏—Ç—å `use search::{...}` –≤ `main.rs`.

**–ü–ª—é—Å—ã:**

- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è ‚Äî —É–¥–∞–ª—è–µ–º –¥—É–±–ª–∏, –¥–æ–±–∞–≤–ª—è–µ–º –∏–º–ø–æ—Ä—Ç—ã
- –ë–µ–Ω—á–º–∞—Ä–∫–∏ –∏ –±–∏–Ω–∞—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ —Ç–∏–ø—ã
- –ü—Ä–∏–≤—ã—á–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è Rust: `lib.rs` —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç, `main.rs` –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç

**–ú–∏–Ω—É—Å—ã:**

- –ù—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å `pub` —É –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π/—Ç–∏–ø–æ–≤ –≤ `lib.rs`, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∏–∑ `main.rs`
- `lib.rs` –ø–æ–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ `tokenize`, `ContentIndex`, `Posting`, `clean_path` ‚Äî –Ω—É–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å

**–†–∏—Å–∫ —Ä–µ–≥—Ä–µ—Å—Å–∏–π:** –ù–∏–∑–∫–∏–π. –¢–∏–ø—ã –∏–¥–µ–Ω—Ç–∏—á–Ω—ã, –ø—Ä–æ—Å—Ç–æ —É–±–∏—Ä–∞–µ–º –∫–æ–ø–∏—é.

#### –í–∞—Ä–∏–∞–Ω—Ç B: –í—ã–Ω–µ—Å—Ç–∏ –æ–±—â–∏–µ —Ç–∏–ø—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å `types.rs`

**–°—É—Ç—å:** –°–æ–∑–¥–∞—Ç—å `src/types.rs`, –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Ç—É–¥–∞ –≤—Å–µ –æ–±—â–∏–µ —Ç–∏–ø—ã, –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –æ–±–æ–∏—Ö –º–µ—Å—Ç–∞—Ö.

**–ü–ª—é—Å—ã:**

- –ß–∏—Å—Ç–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ: `types.rs` ‚Äî —Ç–æ–ª—å–∫–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, `lib.rs` ‚Äî –ø—É–±–ª–∏—á–Ω—ã–π API
- –õ–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å

**–ú–∏–Ω—É—Å—ã:**

- –ë–æ–ª—å—à–µ —Ñ–∞–π–ª–æ–≤
- –õ–∏—à–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å –∫–æ—Å–≤–µ–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è –º–∞–ª–µ–Ω—å–∫–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

#### –í–∞—Ä–∏–∞–Ω—Ç C: –ù–µ –º–µ–Ω—è—Ç—å, –¥–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –Ω–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

**–°—É—Ç—å:** –û—Å—Ç–∞–≤–∏—Ç—å –¥—É–±–ª–∏, –Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã, –ø—Ä–æ–≤–µ—Ä—è—é—â–∏–µ –±–∏–Ω–∞—Ä–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å.

**–ü–ª—é—Å—ã:**

- –ù–æ–ª—å –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥–µ

**–ú–∏–Ω—É—Å—ã:**

- –ù–µ —Ä–µ—à–∞–µ—Ç –∫–æ—Ä–Ω–µ–≤—É—é –ø—Ä–æ–±–ª–µ–º—É
- –¢–µ—Å—Ç—ã –º–æ–≥—É—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –≤ –ª–æ–≥–∏–∫–µ

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: **–í–∞—Ä–∏–∞–Ω—Ç A**

### –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —à–∞–≥–∏

1. –í `lib.rs` ‚Äî —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã —Å `pub`:
   - `Posting`, `ContentIndex`, `clean_path()`, `tokenize()`
   - `FileIndex`, `FileEntry` (—Å–µ–π—á–∞—Å —Ç–æ–ª—å–∫–æ –≤ `main.rs` ‚Äî –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏)

2. –í `main.rs` ‚Äî –∑–∞–º–µ–Ω–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞:

   ```rust
   use search::{clean_path, tokenize, ContentIndex, FileEntry, FileIndex, Posting};
   ```

3. –£–±—Ä–∞—Ç—å –∏–∑ `main.rs`:
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ `struct Posting` (—Å—Ç—Ä–æ–∫–∏ 57‚Äì61)
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ `struct ContentIndex` (—Å—Ç—Ä–æ–∫–∏ 64‚Äì85)
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ `impl ContentIndex` (—Å—Ç—Ä–æ–∫–∏ 87‚Äì95)
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ `struct FileEntry` (—Å—Ç—Ä–æ–∫–∏ 28‚Äì34)
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ `struct FileIndex` (—Å—Ç—Ä–æ–∫–∏ 36‚Äì52)
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ `fn clean_path()` (—Å—Ç—Ä–æ–∫–∏ 22‚Äì24)
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ `fn tokenize()` (—Å—Ç—Ä–æ–∫–∏ 1010‚Äì1015)

4. –í `lib.rs` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å (`FileIndex`, `FileEntry`, `is_stale()` –¥–ª—è –æ–±–æ–∏—Ö)

5. **–ó–∞–ø—É—Å—Ç–∏—Ç—å `cargo test`** ‚Äî —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

6. **–ó–∞–ø—É—Å—Ç–∏—Ç—å `cargo bench --no-run`** ‚Äî –±–µ–Ω—á–º–∞—Ä–∫–∏ –∫–æ–º–ø–∏–ª–∏—Ä—É—é—Ç—Å—è

### –ù–æ–≤—ã–µ —Ç–µ—Å—Ç—ã

```rust
/// –¢–µ—Å—Ç: —Ç–∏–ø –∏–∑ lib.rs —Å–æ–≤–º–µ—Å—Ç–∏–º —Å –±–∏–Ω–∞—Ä–Ω–æ–π —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π
#[test]
fn test_lib_types_bincode_compat() {
    // –°–æ–∑–¥–∞—Ç—å ContentIndex —á–µ—Ä–µ–∑ lib.rs, —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å, –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å
    let ci = search::ContentIndex { ... };
    let bytes = bincode::serialize(&ci).unwrap();
    let ci2: search::ContentIndex = bincode::deserialize(&bytes).unwrap();
    assert_eq!(ci2.root, ci.root);
}
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

- [ ] –í `main.rs` –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è `Posting`, `ContentIndex`, `FileEntry`, `FileIndex`, `clean_path`, `tokenize`
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (`cargo test`)
- [ ] –ë–µ–Ω—á–º–∞—Ä–∫–∏ –∫–æ–º–ø–∏–ª–∏—Ä—É—é—Ç—Å—è (`cargo bench --no-run`)
- [ ] –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ –º–µ–∂–¥—É `lib.rs` –∏ `main.rs`

---

## 4. –§–∞–∑–∞ 2: –°—Ç–∞–±–∏–ª—å–Ω–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—É—Ç–µ–π –∏–Ω–¥–µ–∫—Å–æ–≤

### –ü—Ä–æ–±–ª–µ–º–∞

`index_path_for()`, `content_index_path_for()`, `def_index_path_for()` –∏—Å–ø–æ–ª—å–∑—É—é—Ç `DefaultHasher`, –∫–æ—Ç–æ—Ä—ã–π **–Ω–µ —Å—Ç–∞–±–∏–ª–µ–Ω –º–µ–∂–¥—É –≤–µ—Ä—Å–∏—è–º–∏ Rust**. –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ toolchain –≤—Å–µ –∫–µ—à–∏ —Å—Ç–∞–Ω—É—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã ‚Äî –∏–Ω–¥–µ–∫—Å—ã –±—É–¥—É—Ç –ø–µ—Ä–µ—Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è —Å –Ω—É–ª—è.

### –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ—à–µ–Ω–∏—è

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—É—Ç–∏ –≤ –∏–º—è —Ñ–∞–π–ª–∞ –±–µ–∑ —Ö–µ—à–∞ (‚≠ê –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)

**–°—É—Ç—å:** –í–º–µ—Å—Ç–æ —Ö–µ—à–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å sanitized –ø—É—Ç—å: `C_Projects_MyApp.cidx`

**–ü–ª—é—Å—ã:**

- –ü–æ–ª–Ω–æ—Å—Ç—å—é –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Å—Ç–∏—á–Ω–æ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ –∏–Ω–¥–µ–∫—Å –ø–æ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ (—á–∏—Ç–∞–µ–º–æ)
- –ù–∏–∫–∞–∫–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

**–ú–∏–Ω—É—Å—ã:**

- –î–ª–∏–Ω–Ω—ã–µ –ø—É—Ç–∏ ‚Üí –¥–ª–∏–Ω–Ω—ã–µ –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤ (Windows –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ ~255 —Å–∏–º–≤–æ–ª–æ–≤)
- –ù—É–∂–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è sanitize: `\/:*?` ‚Üí `_`

#### –í–∞—Ä–∏–∞–Ω—Ç B: –°—Ç–∞–±–∏–ª—å–Ω—ã–π —Ö–µ—à (xxhash –∏–ª–∏ FNV)

**–°—É—Ç—å:** –ó–∞–º–µ–Ω–∏—Ç—å `DefaultHasher` –Ω–∞ `xxhash` (crate `xxhash-rust`) –∏–ª–∏ `fnv`.

**–ü–ª—é—Å—ã:**

- –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Å—Ç–∏—á–Ω–æ (–∞–ª–≥–æ—Ä–∏—Ç–º –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω)
- –ö–æ—Ä–æ—Ç–∫–∏–µ –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–ú–∏–Ω—É—Å—ã:**

- –ù–æ–≤–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
- –ò–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤ –Ω–µ—á–∏—Ç–∞–µ–º—ã
- –ü—Ä–∏ —Å–º–µ–Ω–µ —Ö–µ—à-–∞–ª–≥–æ—Ä–∏—Ç–º–∞ ‚Äî —Ç–∞ –∂–µ –ø—Ä–æ–±–ª–µ–º–∞

#### –í–∞—Ä–∏–∞–Ω—Ç C: –°—Ç–∞–±–∏–ª—å–Ω—ã–π —Ö–µ—à –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (—Ä—É—á–Ω–æ–π FNV-1a)

**–°—É—Ç—å:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å FNV-1a (10 —Å—Ç—Ä–æ–∫) –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ. FNV-1a –Ω–∞—Å—Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å—Ç, —á—Ç–æ –Ω–µ –Ω—É–∂–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å.

**–ü–ª—é—Å—ã:**

- –ù–æ–ª—å –Ω–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –°—Ç–∞–±–∏–ª—å–Ω–æ –Ω–∞–≤—Å–µ–≥–¥–∞
- 10-15 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞

**–ú–∏–Ω—É—Å—ã:**

- –°–≤–æ—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (—Ö–æ—Ç—å –∏ —Ç—Ä–∏–≤–∏–∞–ª—å–Ω–∞—è)
- –ù–µ—á–∏—Ç–∞–µ–º—ã–µ –∏–º–µ–Ω–∞

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: **–í–∞—Ä–∏–∞–Ω—Ç A** –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏, –Ω–æ –µ—Å–ª–∏ –ø—É—Ç–∏ –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã–µ ‚Äî **–í–∞—Ä–∏–∞–Ω—Ç C**

–î–ª—è –Ω–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ (Windows + –¥–ª–∏–Ω–Ω—ã–µ –ø—É—Ç–∏ —Ç–∏–ø–∞ `C:\Repos\ProjectName\SubFolder`) **–í–∞—Ä–∏–∞–Ω—Ç C** –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ.

### –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —à–∞–≥–∏

1. –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `stable_path_hash(input: &str) -> u64` —Å FNV-1a:

   ```rust
   fn stable_path_hash(input: &str) -> u64 {
       const FNV_OFFSET: u64 = 0xcbf29ce484222325;
       const FNV_PRIME: u64 = 0x100000001b3;
       let mut hash = FNV_OFFSET;
       for byte in input.bytes() {
           hash ^= byte as u64;
           hash = hash.wrapping_mul(FNV_PRIME);
       }
       hash
   }
   ```

2. –ó–∞–º–µ–Ω–∏—Ç—å `DefaultHasher` –≤:
   - `index_path_for()` (main.rs:485)
   - `content_index_path_for()` (main.rs:508)
   - `def_index_path_for()` (definitions.rs:1006)

3. **–í–ê–ñ–ù–û: –ú–∏–≥—Ä–∞—Ü–∏—è!** –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è –Ω–∞–π—Ç–∏ –∏–Ω–¥–µ–∫—Å –ø–æ —Å—Ç–∞—Ä–æ–º—É —Ö–µ—à—É, —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å/–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å.

   –ò–ª–∏ –ø—Ä–æ—â–µ: –¥–æ–±–∞–≤–∏—Ç—å fallback ‚Äî –µ—Å–ª–∏ –ø–æ –Ω–æ–≤–æ–º—É —Ö–µ—à—É –Ω–µ—Ç, –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–æ —Å—Ç–∞—Ä–æ–º—É.

### –ù–æ–≤—ã–µ —Ç–µ—Å—Ç—ã

```rust
#[test]
fn test_stable_hash_deterministic() {
    let h1 = stable_path_hash(r"C:\Projects\MyApp");
    let h2 = stable_path_hash(r"C:\Projects\MyApp");
    assert_eq!(h1, h2);
}

#[test]
fn test_stable_hash_different_paths() {
    let h1 = stable_path_hash(r"C:\A");
    let h2 = stable_path_hash(r"C:\B");
    assert_ne!(h1, h2);
}

#[test]
fn test_stable_hash_known_value() {
    // –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, —á—Ç–æ–±—ã –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å —Å–ª—É—á–∞–π–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞
    let h = stable_path_hash("test");
    assert_eq!(h, 0xf9e6e6ef197c2b25_u64); // –≤—ã—á–∏—Å–ª–∏—Ç—å —Ä–µ–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
}
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

- [ ] `DefaultHasher` –±–æ–ª—å—à–µ –Ω–∏–≥–¥–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—É—Ç–µ–π –∏–Ω–¥–µ–∫—Å–æ–≤
- [ ] –•–µ—à –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Å—Ç–∏—á–µ–Ω (—Ç–µ—Å—Ç —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º)
- [ ] –°—Ç–∞—Ä—ã–µ –∏–Ω–¥–µ–∫—Å—ã –Ω–∞–π–¥—É—Ç—Å—è —á–µ—Ä–µ–∑ fallback
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

---

## 5. –§–∞–∑–∞ 3: –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (unwrap ‚Üí Result)

### –ü—Ä–æ–±–ª–µ–º–∞

`.unwrap()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö, –∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–∞–Ω–∏–∫–µ:

| –ú–µ—Å—Ç–æ                     | –ß—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç unwrap                             | –ö–æ–≥–¥–∞ —É–ø–∞–¥—ë—Ç                        |
| ------------------------- | ----------------------------------------------- | ----------------------------------- |
| `is_stale()`              | `duration_since(UNIX_EPOCH).unwrap()`           | –°–∏—Å—Ç–µ–º–Ω—ã–µ —á–∞—Å—ã < 1970               |
| `is_stale()`              | `now - self.created_at` (u64 –≤—ã—á–∏—Ç–∞–Ω–∏–µ)         | `created_at` –≤ –±—É–¥—É—â–µ–º (clock skew) |
| `Mutex::lock().unwrap()`  | poisoned mutex                                  | –ü–∞–Ω–∏–∫–∞ –≤ –¥—Ä—É–≥–æ–º –ø–æ—Ç–æ–∫–µ              |
| `entries.lock().unwrap()` | poisoned mutex –≤–æ –≤—Ä–µ–º—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ | –û—à–∏–±–∫–∞ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã             |

### –®–∞–≥–∏

#### 3a. –ò—Å–ø—Ä–∞–≤–∏—Ç—å `is_stale()`

**–¢–µ–∫—É—â–∏–π –∫–æ–¥ (lib.rs:59, main.rs:45, main.rs:88):**

```rust
fn is_stale(&self) -> bool {
    let now = SystemTime::now()
        .duration_since(UNIX_EPOCH)
        .unwrap()
        .as_secs();
    now - self.created_at > self.max_age_secs
}
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥:**

```rust
fn is_stale(&self) -> bool {
    let now = SystemTime::now()
        .duration_since(UNIX_EPOCH)
        .unwrap_or(Duration::ZERO)
        .as_secs();
    // saturating_sub –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç underflow –ø—Ä–∏ clock skew
    now.saturating_sub(self.created_at) > self.max_age_secs
}
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ: –ù–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç–∞ ‚Äî —ç—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è.**

#### 3b. –ò—Å–ø—Ä–∞–≤–∏—Ç—å Mutex-unwrap'—ã –≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö walk'–µ—Ä–∞—Ö

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**

| –í–∞—Ä–∏–∞–Ω—Ç               | –ö–æ–¥                                           | –ö–æ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è—Ç—å                                                                   |
| --------------------- | --------------------------------------------- | --------------------------------------------------------------------------------- |
| `unwrap_or_else`      | `lock().unwrap_or_else(\|e\| e.into_inner())` | –ö–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ –≤ –º—å—é—Ç–µ–∫—Å–µ –º–æ–≥—É—Ç –±—ã—Ç—å "–≥—Ä—è–∑–Ω—ã–º–∏", –Ω–æ –ª—É—á—à–µ –≥—Ä—è–∑–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —á–µ–º –ø–∞–Ω–∏–∫–∞ |
| `expect` —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º | `lock().expect("file walker mutex")`          | –ö–æ–≥–¥–∞ –ø–∞–Ω–∏–∫–∞ –¥–æ–ø—É—Å—Ç–∏–º–∞, –Ω–æ –Ω—É–∂–Ω–æ –≤–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ                                |
| –ë–µ–∑ –º—å—é—Ç–µ–∫—Å–∞          | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `crossbeam` channel              | –ö–æ–≥–¥–∞ —Ö–æ—Ç–∏–º –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑–±–µ–∂–∞—Ç—å –º—å—é—Ç–µ–∫—Å–æ–≤                                          |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** `unwrap_or_else(|e| e.into_inner())` –¥–ª—è –º—å—é—Ç–µ–∫—Å–æ–≤ –≤ walk'–µ—Ä–∞—Ö. –ü–æ—è—Å–Ω–µ–Ω–∏–µ: –µ—Å–ª–∏ –æ–¥–∏–Ω —Ñ–∞–π–ª –≤—ã–∑–≤–∞–ª –ø–∞–Ω–∏–∫—É, —ç—Ç–æ –Ω–µ –¥–æ–ª–∂–Ω–æ —É–±–∏—Ç—å –≤–µ—Å—å –∏–Ω–¥–µ–∫—Å ‚Äî –ª—É—á—à–µ –ø–æ—Ç–µ—Ä—è—Ç—å –æ–¥–∏–Ω —Ñ–∞–π–ª, —á–µ–º —É–ø–∞—Å—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é.

### –ù–æ–≤—ã–µ —Ç–µ—Å—Ç—ã

```rust
#[test]
fn test_is_stale_future_created_at() {
    let index = ContentIndex {
        created_at: u64::MAX, // –¥–∞–ª–µ–∫–æ –≤ –±—É–¥—É—â–µ–º
        max_age_secs: 3600,
        ..Default::default()
    };
    // –ù–µ –¥–æ–ª–∂–µ–Ω –ø–∞–Ω–∏–∫–æ–≤–∞—Ç—å! –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å false (–Ω–µ stale, —Ç.–∫. —Å–æ–∑–¥–∞–Ω "—Ç–æ–ª—å–∫–æ —á—Ç–æ")
    assert!(!index.is_stale());
}

#[test]
fn test_is_stale_zero_max_age() {
    let now = SystemTime::now()
        .duration_since(UNIX_EPOCH)
        .unwrap_or(Duration::ZERO)
        .as_secs();
    let index = ContentIndex {
        created_at: now,
        max_age_secs: 0,
        ..Default::default()
    };
    // created_at == now, max_age == 0 ‚Üí 0 > 0 ‚Üí false (–Ω–µ stale)
    assert!(!index.is_stale());
}
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

- [ ] –ù–∏ –æ–¥–Ω–æ–≥–æ –≥–æ–ª–æ–≥–æ `.unwrap()` –Ω–∞ `SystemTime` –∏–ª–∏ `Duration`
- [ ] `saturating_sub` –≤–µ–∑–¥–µ –≥–¥–µ –≤—ã—á–∏—Ç–∞–Ω–∏–µ `u64`
- [ ] –ú—å—é—Ç–µ–∫—Å—ã –≤ walk'–µ—Ä–∞—Ö –∏—Å–ø–æ–ª—å–∑—É—é—Ç `unwrap_or_else` –∏–ª–∏ `expect`
- [ ] –ù–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –Ω–∞ edge cases (future timestamp, zero max_age)
- [ ] –í—Å–µ —Å—Ç–∞—Ä—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

---

## 6. –§–∞–∑–∞ 4: –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–∏–ø –æ—à–∏–±–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞

–í—Å–µ –ø—É–±–ª–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç `Result<T, Box<dyn std::error::Error>>`. –≠—Ç–æ –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–∑—ã–≤–∞—é—â–µ–º—É –∫–æ–¥—É –º–∞—Ç—á–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏. –ö—Ä–æ–º–µ —Ç–æ–≥–æ, `Box<dyn Error>` –∞–ª–ª–æ—Ü–∏—Ä—É–µ—Ç –Ω–∞ –∫—É—á–µ –∏ —Ç—Ä–µ–±—É–µ—Ç `std`.

### –í–∞—Ä–∏–∞–Ω—Ç—ã

#### –í–∞—Ä–∏–∞–Ω—Ç A: thiserror (‚≠ê –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)

```rust
// src/error.rs
use thiserror::Error;

#[derive(Error, Debug)]
pub enum SearchError {
    #[error("I/O error: {0}")]
    Io(#[from] std::io::Error),

    #[error("Serialization error: {0}")]
    Serialization(#[from] bincode::Error),

    #[error("Index not found for directory: {dir}")]
    IndexNotFound { dir: String },

    #[error("Invalid regex pattern '{pattern}': {source}")]
    InvalidRegex {
        pattern: String,
        source: regex::Error,
    },

    #[error("Directory does not exist: {0}")]
    DirNotFound(String),

    #[error("Index is stale (age: {age_secs}s, max: {max_secs}s)")]
    StaleIndex { age_secs: u64, max_secs: u64 },

    #[error("Lock poisoned: {0}")]
    LockPoisoned(String),
}
```

**–ü–ª—é—Å—ã:** derive-–º–∞–∫—Ä–æ—Å, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ `From` –∫–æ–Ω–≤–µ—Ä—Å–∏–∏, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ–¥—Ö–æ–¥
**–ú–∏–Ω—É—Å—ã:** –ù–æ–≤–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å (thiserror)

#### –í–∞—Ä–∏–∞–Ω—Ç B: –†—É—á–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```rust
#[derive(Debug)]
pub enum SearchError {
    Io(std::io::Error),
    Serialization(bincode::Error),
    // ...
}

impl std::fmt::Display for SearchError { ... }
impl std::error::Error for SearchError { ... }
impl From<std::io::Error> for SearchError { ... }
```

**–ü–ª—é—Å—ã:** –ù–æ–ª—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
**–ú–∏–Ω—É—Å—ã:** ~50 —Å—Ç—Ä–æ–∫ –±–æ–π–ª–µ—Ä–ø–ª–µ–π—Ç–∞

#### –í–∞—Ä–∏–∞–Ω—Ç C: anyhow (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –±–∏–±–ª–∏–æ—Ç–µ–∫)

**–ü–ª—é—Å—ã:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–¥
**–ú–∏–Ω—É—Å—ã:** `anyhow::Error` –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–∞—Ç—á–∏—Ç—å –æ—à–∏–±–∫–∏ ‚Äî –ø–æ–¥—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –Ω–µ –¥–ª—è –±–∏–±–ª–∏–æ—Ç–µ–∫

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: **–í–∞—Ä–∏–∞–Ω—Ç A (thiserror)**

–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ: –ø—Ä–æ–µ–∫—Ç —É–∂–µ –∏–º–µ–µ—Ç 10+ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –æ–¥–Ω–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å (thiserror ‚Äî compile-time only, zero runtime cost) ‚Äî –ø—Ä–∏–µ–º–ª–µ–º–æ. –ü—Ä–∏ —ç—Ç–æ–º —ç–∫–æ–Ω–æ–º–∏—Ç ~50 —Å—Ç—Ä–æ–∫ –±–æ–π–ª–µ—Ä–ø–ª–µ–π—Ç–∞ –∏ —Å–Ω–∏–∂–∞–µ—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ—à–∏–±–æ–∫ –≤ `impl Error`.

### –®–∞–≥–∏

1. –î–æ–±–∞–≤–∏—Ç—å `thiserror = "2"` –≤ `[dependencies]`
2. –°–æ–∑–¥–∞—Ç—å `src/error.rs` —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º `SearchError`
3. –ó–∞–º–µ–Ω–∏—Ç—å `Box<dyn Error>` –Ω–∞ `SearchError` –≤:
   - `save_index()`
   - `save_content_index()`
   - `save_definition_index()`
4. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `SearchError` –∏–∑ `lib.rs`
5. –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç `Result`

### –ù–æ–≤—ã–µ —Ç–µ—Å—Ç—ã

```rust
#[test]
fn test_save_index_to_nonexistent_dir() {
    let index = FileIndex { root: "/nonexistent/path".to_string(), ... };
    let result = save_index(&index);
    assert!(matches!(result, Err(SearchError::Io(_))));
}
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

- [ ] `Box<dyn Error>` –Ω–∏–≥–¥–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ pub —Ñ—É–Ω–∫—Ü–∏—è—Ö
- [ ] `SearchError` –æ–ø—Ä–µ–¥–µ–ª—ë–Ω –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω
- [ ] –í—Å–µ –≤—ã–∑–æ–≤—ã `save_*` / `load_*` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—à–∏–±–æ–∫
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

---

## 7. –§–∞–∑–∞ 5: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (total_tokens)

### –ü—Ä–æ–±–ª–µ–º–∞

–í `watcher.rs:update_file_in_index()` –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ñ–∞–π–ª–∞:

1. –°—Ç–∞—Ä—ã–µ —Ç–æ–∫–µ–Ω—ã —É–¥–∞–ª—è—é—Ç—Å—è –∏–∑ –∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ ‚úÖ
2. –ù–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è, –∏ `total_tokens += 1` –∑–∞ –∫–∞–∂–¥—ã–π ‚úÖ
3. **–ù–æ —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `total_tokens` –Ω–µ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è** ‚ùå

–≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–º—É —Ä–æ—Å—Ç—É `total_tokens`, —á—Ç–æ –∏—Å–∫–∞–∂–∞–µ—Ç TF-IDF:

- IDF = ln(total_docs / doc_freq) ‚Äî –Ω–æ total_docs –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
- TF = occurrences / file_total ‚Äî file_total –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
- –û–¥–Ω–∞–∫–æ –µ—Å–ª–∏ `total_tokens` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≥–¥–µ-—Ç–æ –µ—â—ë, –∑–Ω–∞—á–µ–Ω–∏–µ –¥—Ä–∏—Ñ—Ç–∏—Ç

### –®–∞–≥–∏

1. –í `update_file_in_index()`, –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º —Å—Ç–∞—Ä—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤:

   ```rust
   // –ó–∞–ø–æ–º–Ω–∏—Ç—å —Å—Ç–∞—Ä—ã–π token count –¥–ª—è —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞
   let old_count = if (file_id as usize) < index.file_token_counts.len() {
       index.file_token_counts[file_id as usize] as u64
   } else {
       0u64
   };
   // –í—ã—á–µ—Å—Ç—å –∏–∑ total_tokens
   index.total_tokens = index.total_tokens.saturating_sub(old_count);
   ```

2. –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ ‚Äî `total_tokens` —É–∂–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –≤ —Ü–∏–∫–ª–µ.

3. –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –≤ `remove_file_from_index()`:
   ```rust
   let old_count = if (file_id as usize) < index.file_token_counts.len() {
       index.file_token_counts[file_id as usize] as u64
   } else {
       0u64
   };
   index.total_tokens = index.total_tokens.saturating_sub(old_count);
   ```

### –ù–æ–≤—ã–µ —Ç–µ—Å—Ç—ã

```rust
#[test]
fn test_total_tokens_after_update() {
    // –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å —Å known total_tokens
    // –û–±–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª (–Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç)
    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ total_tokens == –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
}

#[test]
fn test_total_tokens_after_remove() {
    // –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å
    // –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª
    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ total_tokens —É–º–µ–Ω—å—à–∏–ª—Å—è –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
}

#[test]
fn test_total_tokens_consistency() {
    // –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å
    // –í—ã–ø–æ–ª–Ω–∏—Ç—å N –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
    // –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å total_tokens –≤—Ä—É—á–Ω—É—é (—Å—É–º–º–∞ file_token_counts)
    // –°—Ä–∞–≤–Ω–∏—Ç—å —Å index.total_tokens
}
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

- [ ] `total_tokens` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞
- [ ] `total_tokens` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞
- [ ] –¢–µ—Å—Ç –Ω–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å `total_tokens == sum(file_token_counts)` –ø—Ä–æ—Ö–æ–¥–∏—Ç
- [ ] –í—Å–µ —Å—Ç–∞—Ä—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

---

## 8. –§–∞–∑–∞ 6: –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ process::exit

### –ü—Ä–æ–±–ª–µ–º–∞

`std::process::exit(1)` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ 6 –º–µ—Å—Ç–∞—Ö –≤–Ω—É—Ç—Ä–∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏:

- `cmd_find()` (main.rs:659) ‚Äî invalid regex
- `cmd_find()` (main.rs:669) ‚Äî directory not found
- `cmd_fast()` (main.rs:917) ‚Äî invalid regex
- `cmd_grep()` (main.rs:1202) ‚Äî no tokens in phrase
- `cmd_grep()` (main.rs:1214) ‚Äî failed to build regex
- `cmd_grep()` (main.rs:1185) ‚Äî no content index
- `cmd_content_index()` (main.rs:1145) ‚Äî failed to save
- `cmd_index()` (main.rs:850) ‚Äî failed to save

`process::exit()` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã, –Ω–µ unwinding'–∏—Ç —Å—Ç–µ–∫, –∏ –¥–µ–ª–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ—Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã–º–∏.

### –®–∞–≥–∏

1. –ò–∑–º–µ–Ω–∏—Ç—å —Å–∏–≥–Ω–∞—Ç—É—Ä—ã `cmd_*` —Ñ—É–Ω–∫—Ü–∏–π:

   ```rust
   // –ë—ã–ª–æ:
   fn cmd_find(args: FindArgs) { ... process::exit(1); }

   // –°—Ç–∞–ª–æ:
   fn cmd_find(args: FindArgs) -> Result<(), SearchError> { ... return Err(...); }
   ```

2. –í `fn main()`:

   ```rust
   fn main() {
       let cli = Cli::parse();
       let result = match cli.command {
           Commands::Find(args) => cmd_find(args),
           Commands::Index(args) => cmd_index(args),
           // ...
       };
       if let Err(e) = result {
           eprintln!("Error: {}", e);
           std::process::exit(1); // –¢–æ–ª—å–∫–æ –∑–¥–µ—Å—å!
       }
   }
   ```

3. –ó–∞–º–µ–Ω–∏—Ç—å –∫–∞–∂–¥—ã–π `process::exit(1)` –Ω–∞ `return Err(SearchError::...)`:
   - `eprintln!("Invalid regex: ..."); process::exit(1);` ‚Üí `return Err(SearchError::InvalidRegex { ... })`
   - `eprintln!("Directory does not exist: ..."); process::exit(1);` ‚Üí `return Err(SearchError::DirNotFound(...))`

### –ù–æ–≤—ã–µ —Ç–µ—Å—Ç—ã

```rust
#[test]
fn test_cmd_find_invalid_regex_returns_error() {
    let args = FindArgs {
        pattern: "[invalid".to_string(),
        regex: true,
        ..default_find_args()
    };
    let result = cmd_find(args);
    assert!(matches!(result, Err(SearchError::InvalidRegex { .. })));
}

#[test]
fn test_cmd_find_nonexistent_dir_returns_error() {
    let args = FindArgs {
        dir: "/definitely/not/a/real/path".to_string(),
        ..default_find_args()
    };
    let result = cmd_find(args);
    assert!(matches!(result, Err(SearchError::DirNotFound(_))));
}
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

- [ ] `process::exit()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¢–û–õ–¨–ö–û –≤ `fn main()`
- [ ] –í—Å–µ `cmd_*` —Ñ—É–Ω–∫—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç `Result<(), SearchError>`
- [ ] –¢–µ—Å—Ç—ã –Ω–∞ –æ—à–∏–±–æ—á–Ω—ã–µ –≤—Ö–æ–¥—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã `SearchError`
- [ ] –í—Å–µ —Å—Ç–∞—Ä—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

---

## 9. –§–∞–∑–∞ 7: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∑–∞–ø–∏—Å–∏ –≤ MCP —Å–µ—Ä–≤–µ—Ä–µ

### –ü—Ä–æ–±–ª–µ–º–∞

–í `server.rs:60` –∏ `server.rs:77`:

```rust
let _ = writeln!(writer, "{}", resp_str);
let _ = writer.flush();
```

`let _ =` —è–≤–Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –æ—à–∏–±–∫—É –∑–∞–ø–∏—Å–∏. –ï—Å–ª–∏ stdout –∑–∞–∫—Ä—ã—Ç (–∫–ª–∏–µ–Ω—Ç –æ—Ç–∫–ª—é—á–∏–ª—Å—è), —Å–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ —á–∏—Ç–∞—Ç—å stdin –∏ –ø—ã—Ç–∞—Ç—å—Å—è –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –æ—Ç–≤–µ—Ç—ã –≤ –Ω–∏–∫—É–¥–∞.

### –í–∞—Ä–∏–∞–Ω—Ç—ã

#### –í–∞—Ä–∏–∞–Ω—Ç A: –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∏ –∑–∞–≤–µ—Ä—à–∏—Ç—å (‚≠ê –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)

```rust
if let Err(e) = writeln!(writer, "{}", resp_str) {
    error!(error = %e, "Failed to write response to stdout, shutting down");
    break;
}
if let Err(e) = writer.flush() {
    error!(error = %e, "Failed to flush stdout, shutting down");
    break;
}
```

**–ü–ª—é—Å—ã:** –ß–∏—Å—Ç–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ, –ª–æ–≥-—Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
**–ú–∏–Ω—É—Å—ã:** –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ ‚Äî –æ–¥–Ω–∞ –æ—à–∏–±–∫–∞ = –∫–æ–Ω–µ—Ü

#### –í–∞—Ä–∏–∞–Ω—Ç B: –°—á—ë—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ —Å –ø–æ—Ä–æ–≥–æ–º

```rust
let mut write_errors = 0;
// ...
if let Err(e) = writeln!(writer, "{}", resp_str) {
    write_errors += 1;
    error!(error = %e, consecutive_errors = write_errors, "Failed to write response");
    if write_errors >= 3 {
        error!("Too many write errors, shutting down");
        break;
    }
    continue;
} else {
    write_errors = 0;
}
```

**–ü–ª—é—Å—ã:** –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ transient-–æ—à–∏–±–∫–∞–º
**–ú–∏–Ω—É—Å—ã:** –°–ª–æ–∂–Ω–µ–µ, –∏ –¥–ª—è stdio transient-–æ—à–∏–±–∫–∏ –º–∞–ª–æ–≤–µ—Ä–æ—è—Ç–Ω—ã

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: **–í–∞—Ä–∏–∞–Ω—Ç A**

–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ: –¥–ª—è stdio-–∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ –æ—à–∏–±–∫–∏ –∑–∞–ø–∏—Å–∏ –≤—Å–µ–≥–¥–∞ –æ–∑–Ω–∞—á–∞—é—Ç, —á—Ç–æ –∫–ª–∏–µ–Ω—Ç –æ—Ç–∫–ª—é—á–∏–ª—Å—è. Retry –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–µ–Ω ‚Äî pipe —Å–ª–æ–º–∞–Ω. –ß–∏—Å—Ç–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ.

### –®–∞–≥–∏

1. –ó–∞–º–µ–Ω–∏—Ç—å `let _ = writeln!` –∏ `let _ = writer.flush()` –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É —Å `break`
2. –î–æ–±–∞–≤–∏—Ç—å `error!()` –ª–æ–≥ –ø–µ—Ä–µ–¥ `break`

### –ù–æ–≤—ã–µ —Ç–µ—Å—Ç—ã

–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ stdio-—Å–µ—Ä–≤–µ—Ä–∞ —Å–ª–æ–∂–Ω–æ. –ù–æ –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å `handle_request()` –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ (—É–∂–µ –µ—Å—Ç—å), –∏ –¥–æ–±–∞–≤–∏—Ç—å:

```rust
#[test]
fn test_handle_request_returns_valid_json_for_all_methods() {
    let ctx = make_ctx();
    let methods = ["initialize", "tools/list", "ping", "unknown"];
    for method in methods {
        let result = handle_request(&ctx, method, &None, json!(1));
        // –ö–∞–∂–¥—ã–π –æ—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å jsonrpc –∏ id
        assert_eq!(result["jsonrpc"], "2.0");
        assert!(result.get("id").is_some());
    }
}
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

- [ ] `let _ =` –Ω–∞ writeln/flush –∑–∞–º–µ–Ω–µ–Ω–æ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É —Å break
- [ ] –ü—Ä–∏ –æ—à–∏–±–∫–µ –∑–∞–ø–∏—Å–∏ ‚Äî –ª–æ–≥ + graceful shutdown
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

---

## 10. –§–∞–∑–∞ 8: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ç—Ä–µ–π—Ç—ã –¥–ª—è DefinitionKind

### –ü—Ä–æ–±–ª–µ–º–∞

`DefinitionKind::from_str()` ‚Äî inherent –º–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π —Ç–µ–Ω—å—é —Å–∫—Ä—ã–≤–∞–µ—Ç std::str::FromStr.
–ù–µ—Ç `Display`. –ù–µ—Ç `Default`.

### –®–∞–≥–∏

1. –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å `from_str()` ‚Üí —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `impl FromStr`:

   ```rust
   impl std::str::FromStr for DefinitionKind {
       type Err = String;
       fn from_str(s: &str) -> Result<Self, Self::Err> {
           match s.to_lowercase().as_str() {
               "class" => Ok(Self::Class),
               // ...
               other => Err(format!("Unknown definition kind: '{}'", other)),
           }
       }
   }
   ```

2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `Display`:

   ```rust
   impl std::fmt::Display for DefinitionKind {
       fn fmt(&self, f: &mut std::fmt::Formatter<'_>) -> std::fmt::Result {
           write!(f, "{}", self.as_str())
       }
   }
   ```

3. –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –≤—ã–∑–æ–≤—ã `DefinitionKind::from_str(s)` ‚Üí `s.parse::<DefinitionKind>()`

### –ù–æ–≤—ã–µ —Ç–µ—Å—Ç—ã

```rust
#[test]
fn test_definition_kind_parse() {
    assert_eq!("class".parse::<DefinitionKind>().unwrap(), DefinitionKind::Class);
    assert!("invalid".parse::<DefinitionKind>().is_err());
}

#[test]
fn test_definition_kind_display() {
    assert_eq!(format!("{}", DefinitionKind::Class), "class");
    assert_eq!(format!("{}", DefinitionKind::StoredProcedure), "storedProcedure");
}

#[test]
fn test_definition_kind_roundtrip_all() {
    let all_kinds = vec![
        DefinitionKind::Class, DefinitionKind::Interface, DefinitionKind::Method,
        // ... –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
    ];
    for kind in all_kinds {
        let s = kind.to_string();
        let parsed: DefinitionKind = s.parse().unwrap();
        assert_eq!(parsed, kind);
    }
}
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

- [ ] `FromStr` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] `Display` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] –ù–µ—Ç inherent `from_str()` –º–µ—Ç–æ–¥–∞
- [ ] Roundtrip —Ç–µ—Å—Ç: `Display` ‚Üí `FromStr` –¥–ª—è –≤—Å–µ—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

---

## 11. –§–∞–∑–∞ 9: –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥–≤–æ–π–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤

### –ü—Ä–æ–±–ª–µ–º–∞

–í `handle_phrase_search()` (handlers.rs) —Ñ–∞–π–ª —á–∏—Ç–∞–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã:

1. –°—Ç—Ä–æ–∫–∞ 605: `std::fs::read_to_string(file_path)` ‚Äî –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ phrase
2. –°—Ç—Ä–æ–∫–∞ 656: `std::fs::read_to_string(&r.file_path)` ‚Äî –¥–ª—è show_lines

### –®–∞–≥–∏

1. –í `PhraseMatch` —Å—Ç—Ä—É–∫—Ç—É—Ä–µ ‚Äî –¥–æ–±–∞–≤–∏—Ç—å `content: Option<String>`
2. –ü—Ä–∏ –ø–µ—Ä–≤–æ–º —á—Ç–µ–Ω–∏–∏ (–ø—Ä–æ–≤–µ—Ä–∫–∞ phrase) ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç:
   ```rust
   struct PhraseMatch {
       file_path: String,
       lines: Vec<u32>,
       content: String, // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —á—Ç–µ–Ω–∏–∏
   }
   ```
3. –ü—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ `show_lines` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `r.content` –≤–º–µ—Å—Ç–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ `read_to_string`

4. **–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ** –≤ `handle_search_grep()` (handlers.rs:472) ‚Äî —Ñ–∞–π–ª —á–∏—Ç–∞–µ—Ç—Å—è –¥–ª—è show_lines –ø–æ—Å–ª–µ –ø–æ–∏—Å–∫–∞ –ø–æ –∏–Ω–¥–µ–∫—Å—É. –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ (–Ω–µ—Ç –¥–≤–æ–π–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è). –ù–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å.

### –ù–æ–≤—ã–µ —Ç–µ—Å—Ç—ã

–¢–µ—Å—Ç—ã –Ω–∞ phrase search —É–∂–µ –µ—Å—Ç—å. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ show_lines —Ä–∞–±–æ—Ç–∞–µ—Ç:

```rust
#[test]
fn test_phrase_search_with_show_lines() {
    // –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω–¥–µ–∫—Å —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
    // –í—ã–∑–≤–∞—Ç—å handle_phrase_search —Å show_lines=true
    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ lineContent –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –æ—Ç–≤–µ—Ç–µ
}
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

- [ ] –§–∞–π–ª —á–∏—Ç–∞–µ—Ç—Å—è —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ phrase search
- [ ] show_lines —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

---

## 12. –§–∞–∑–∞ 10: –†–∞–∑–±–∏–µ–Ω–∏–µ main.rs –Ω–∞ –º–æ–¥—É–ª–∏

### –ü—Ä–æ–±–ª–µ–º–∞

`main.rs` ‚Äî 2734 —Å—Ç—Ä–æ–∫–∏. –°–æ–¥–µ—Ä–∂–∏—Ç CLI –∞—Ä–≥—É–º–µ–Ω—Ç—ã, —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö, –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É, –∏ ~860 —Å—Ç—Ä–æ–∫ —Ç–µ—Å—Ç–æ–≤. –≠—Ç–æ –∑–∞—Ç—Ä—É–¥–Ω—è–µ—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏—é –∏ –Ω–∞—Ä—É—à–∞–µ—Ç SRP.

### ‚ö†Ô∏è –≠—Ç–∞ —Ñ–∞–∑–∞ —Å–∞–º–∞—è —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω–∞—è —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è —Ä–µ–≥—Ä–µ—Å—Å–∏–π!

**–ü—Ä–∞–≤–∏–ª–æ:** –ø–µ—Ä–µ–º–µ—â–∞–µ–º —Ç–æ–ª—å–∫–æ –∫–æ–¥, –ù–ï –º–µ–Ω—è–µ–º –ª–æ–≥–∏–∫—É. –ö–∞–∂–¥—ã–π –ø–µ—Ä–µ–º–µ—â—ë–Ω–Ω—ã–π –º–æ–¥—É–ª—å = –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–º–º–∏—Ç.

### –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
src/
  main.rs          ‚Äî fn main() + CLI args (Cli, Commands, *Args)
  lib.rs           ‚Äî –ü—É–±–ª–∏—á–Ω—ã–π API (—Ç–∏–ø—ã, tokenize, clean_path)
  error.rs         ‚Äî SearchError (–∏–∑ –§–∞–∑—ã 4)
  index.rs         ‚Äî FileIndex, ContentIndex, build/save/load
  search.rs        ‚Äî cmd_find, cmd_fast, cmd_grep, cmd_info
  definitions.rs   ‚Äî –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
  mcp/
    mod.rs          ‚Äî –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    server.rs       ‚Äî –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    handlers.rs     ‚Äî –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    watcher.rs      ‚Äî –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
```

### –®–∞–≥–∏

**–®–∞–≥ 1: –í—ã–Ω–µ—Å—Ç–∏ index.rs**

–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –∏–∑ main.rs:

- `struct FileEntry`
- `struct FileIndex` + `impl FileIndex`
- `struct Posting`
- `struct ContentIndex` + `impl ContentIndex`
- `fn index_dir()`
- `fn index_path_for()`
- `fn content_index_path_for()`
- `fn save_index()`, `fn load_index()`
- `fn save_content_index()`, `fn load_content_index()`
- `fn find_content_index_for_dir()`
- `fn build_index()`
- `fn build_content_index()`
- `fn tokenize()` (–µ—Å–ª–∏ –µ—â—ë –Ω–µ –≤ lib.rs –ø–æ—Å–ª–µ –§–∞–∑—ã 1)

–í main.rs –¥–æ–±–∞–≤–∏—Ç—å: `mod index;` –∏ `use index::*;`

**–®–∞–≥ 2: –í—ã–Ω–µ—Å—Ç–∏ search.rs**

–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –∏–∑ main.rs:

- `fn cmd_find()`
- `fn cmd_fast()`
- `fn cmd_grep()`
- `fn cmd_content_index()`
- `fn cmd_info()`
- `fn cmd_info_json()`
- `fn cmd_def_index()`

–í main.rs –¥–æ–±–∞–≤–∏—Ç—å: `mod search;` –∏ `use search::*;`

**–®–∞–≥ 3: –í main.rs –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ:**

- CLI structs (Cli, Commands, \*Args)
- `fn main()`
- `mod index;`
- `mod search;`
- `mod definitions;`
- `mod mcp;`

### –ù–æ–≤—ã–µ —Ç–µ—Å—Ç—ã

–ù–µ—Ç –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤ –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ ‚Äî –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å. –ü–µ—Ä–µ–º–µ—â–∞–µ–º —Ç–µ—Å—Ç—ã –≤–º–µ—Å—Ç–µ —Å –∫–æ–¥–æ–º:

- –¢–µ—Å—Ç—ã –¥–ª—è index —Ñ—É–Ω–∫—Ü–∏–π ‚Üí `index.rs` (–≤ `#[cfg(test)]`)
- –¢–µ—Å—Ç—ã –¥–ª—è search —Ñ—É–Ω–∫—Ü–∏–π ‚Üí `search.rs` (–≤ `#[cfg(test)]`)

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

- [ ] `main.rs` —Å–æ–¥–µ—Ä–∂–∏—Ç < 150 —Å—Ç—Ä–æ–∫
- [ ] –ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å < 1000 —Å—Ç—Ä–æ–∫
- [ ] –í–°–ï —Å—Ç–∞—Ä—ã–µ —Ç–µ—Å—Ç—ã –∫–æ–º–ø–∏–ª–∏—Ä—É—é—Ç—Å—è –∏ –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] `cargo test` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ –∂–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤, —á—Ç–æ –∏ baseline
- [ ] `cargo bench --no-run` –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è

---

## 13. –§–∞–∑–∞ 11: –ú–µ–ª–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### 11a. –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ `use serde_json::json;` –Ω–∞–≤–µ—Ä—Ö –≤ server.rs

–°—Ç—Ä–æ–∫–∞ 152 ‚Üí –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –∫ –æ—Å—Ç–∞–ª—å–Ω—ã–º use –Ω–∞ —Å—Ç—Ä–æ–∫—É 6.

### 11b. –î–æ–±–∞–≤–∏—Ç—å `#[must_use]` –Ω–∞ —á–∏—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

```rust
#[must_use]
pub fn clean_path(p: &str) -> String { ... }

#[must_use]
pub fn tokenize(line: &str, min_len: usize) -> Vec<String> { ... }
```

### 11c. –î–æ–±–∞–≤–∏—Ç—å `Default` –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∏–ø–æ–≤

```rust
impl Default for ContentIndex {
    fn default() -> Self {
        Self {
            root: String::new(),
            created_at: 0,
            max_age_secs: 86400,
            files: Vec::new(),
            index: HashMap::new(),
            total_tokens: 0,
            extensions: Vec::new(),
            file_token_counts: Vec::new(),
            forward: None,
            path_to_id: None,
        }
    }
}
```

### 11d. –ó–∞–ø—É—Å—Ç–∏—Ç—å `cargo clippy -- -W clippy::all` –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ warnings

### 11e. –ó–∞–º–µ–Ω–∏—Ç—å magic numbers –Ω–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã

```rust
const DEFAULT_MAX_RESULTS_MCP: usize = 50;
const DEFAULT_MAX_RESULTS_DEFS: usize = 100;
const DEFAULT_MAX_AGE_HOURS: u64 = 24;
const DEFAULT_MIN_TOKEN_LEN: usize = 2;
const DEFAULT_DEBOUNCE_MS: u64 = 500;
const DEFAULT_BULK_THRESHOLD: usize = 100;
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

- [ ] `cargo clippy -- -W clippy::all` ‚Äî –Ω–æ–ª—å warnings
- [ ] `#[must_use]` –Ω–∞ pure —Ñ—É–Ω–∫—Ü–∏—è—Ö
- [ ] Magic numbers –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
- [ ] `Default` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∏–ø–æ–≤
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

---

## 14. –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```mermaid
graph TD
    F0[–§–∞–∑–∞ 0: Baseline] --> F1[–§–∞–∑–∞ 1: –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –¥—É–±–ª–∏ —Ç–∏–ø–æ–≤]
    F1 --> F2[–§–∞–∑–∞ 2: –°—Ç–∞–±–∏–ª—å–Ω–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ]
    F1 --> F3[–§–∞–∑–∞ 3: unwrap ‚Üí safe]
    F3 --> F4[–§–∞–∑–∞ 4: SearchError —Ç–∏–ø]
    F4 --> F6[–§–∞–∑–∞ 6: –£–±—Ä–∞—Ç—å process::exit]
    F1 --> F5[–§–∞–∑–∞ 5: total_tokens fix]
    F1 --> F7[–§–∞–∑–∞ 7: MCP write errors]
    F1 --> F8[–§–∞–∑–∞ 8: DefinitionKind traits]
    F1 --> F9[–§–∞–∑–∞ 9: –î–≤–æ–π–Ω–æ–µ —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤]
    F6 --> F10[–§–∞–∑–∞ 10: –†–∞–∑–±–∏–µ–Ω–∏–µ main.rs]
    F4 --> F10
    F10 --> F11[–§–∞–∑–∞ 11: –ú–µ–ª–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è]

    style F0 fill:#e8e8e8
    style F1 fill:#ff9999
    style F3 fill:#ff9999
    style F4 fill:#ffcc99
    style F5 fill:#ff9999
    style F6 fill:#ffcc99
    style F10 fill:#99ccff
    style F11 fill:#ccffcc
```

**–¶–≤–µ—Ç–æ–≤–∞—è –ª–µ–≥–µ–Ω–¥–∞:**

- üî¥ –ö—Ä–∞—Å–Ω—ã–π ‚Äî –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å
- üü† –û—Ä–∞–Ω–∂–µ–≤—ã–π ‚Äî –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ error handling
- üîµ –°–∏–Ω–∏–π ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- üü¢ –ó–µ–ª—ë–Ω—ã–π ‚Äî polish

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫ (—Å —É—á—ë—Ç–æ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)

| #   | –§–∞–∑–∞                   | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç | –†–∏—Å–∫ —Ä–µ–≥—Ä–µ—Å—Å–∏–π | –¢—Ä—É–¥–æ—ë–º–∫–æ—Å—Ç—å |
| --- | ---------------------- | ---------- | -------------- | ------------ |
| 0   | Baseline               | ‚Äî          | –ù—É–ª–µ–≤–æ–π        | 10 –º–∏–Ω       |
| 1   | –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–µ–π      | F0         | –ù–∏–∑–∫–∏–π         | 1-2 —á–∞—Å–∞     |
| 5   | total_tokens fix       | F1         | –ù–∏–∑–∫–∏–π         | 30 –º–∏–Ω       |
| 3   | unwrap ‚Üí safe          | F1         | –ù–∏–∑–∫–∏–π         | 1 —á–∞—Å        |
| 2   | –°—Ç–∞–±–∏–ª—å–Ω–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ | F1         | –°—Ä–µ–¥–Ω–∏–π        | 1 —á–∞—Å        |
| 8   | DefinitionKind traits  | F1         | –ù–∏–∑–∫–∏–π         | 30 –º–∏–Ω       |
| 9   | –î–≤–æ–π–Ω–æ–µ —á—Ç–µ–Ω–∏–µ         | F1         | –ù–∏–∑–∫–∏–π         | 30 –º–∏–Ω       |
| 7   | MCP write errors       | F1         | –ù–∏–∑–∫–∏–π         | 20 –º–∏–Ω       |
| 4   | SearchError            | F3         | –°—Ä–µ–¥–Ω–∏–π        | 2 —á–∞—Å–∞       |
| 6   | –£–±—Ä–∞—Ç—å process::exit   | F4         | –°—Ä–µ–¥–Ω–∏–π        | 1.5 —á–∞—Å–∞     |
| 10  | –†–∞–∑–±–∏–µ–Ω–∏–µ main.rs      | F4, F6     | **–í—ã—Å–æ–∫–∏–π**    | 3-4 —á–∞—Å–∞     |
| 11  | –ú–µ–ª–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è       | F10        | –ù–∏–∑–∫–∏–π         | 1 —á–∞—Å        |

**–ò—Ç–æ–≥–æ:** ~12-14 —á–∞—Å–æ–≤ —Ä–∞–±–æ—Ç—ã, 11 —Ñ–∞–∑, 11+ –∫–æ–º–º–∏—Ç–æ–≤

---

## 15. –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ–∞–∑—ã

–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ñ–∞–∑—ã:

- [ ] –í–µ—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ –æ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫–æ–º–º–∏—Ç–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Ñ–∞–∑—ã
- [ ] `cargo test` –ø—Ä–æ—Ö–æ–¥–∏—Ç –Ω–∞ 100% –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏

–í–æ –≤—Ä–µ–º—è —Ñ–∞–∑—ã:

- [ ] –ò–∑–º–µ–Ω–µ–Ω–∏—è –º–∏–Ω–∏–º–∞–ª—å–Ω—ã –∏ –∞—Ç–æ–º–∞—Ä–Ω—ã
- [ ] –ù–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã –î–û –∏–ª–∏ –û–î–ù–û–í–†–ï–ú–ï–ù–ù–û —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ (–Ω–æ –Ω–µ –ø–æ–∑–∂–µ)
- [ ] –ö–∞–∂–¥—ã–π –±–ª–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `cargo test`

–ü–æ—Å–ª–µ —Ñ–∞–∑—ã:

- [ ] `cargo build` –ø—Ä–æ—Ö–æ–¥–∏—Ç
- [ ] `cargo test` ‚Äî –í–°–ï —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤ >= baseline + –Ω–æ–≤—ã–µ
- [ ] `cargo clippy` ‚Äî –Ω–µ—Ç –Ω–æ–≤—ã—Ö warnings
- [ ] `cargo bench --no-run` ‚Äî –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è
- [ ] **E2E —Ç–µ—Å—Ç—ã** –ø—Ä–æ—Ö–æ–¥—è—Ç ‚Üí —Å–º. [E2E Test Plan](e2e-test-plan.md)
      –ó–∞–ø—É—Å–∫–∞—Ç—å: `./e2e-test.ps1` (–∏–ª–∏ –≤—Ä—É—á–Ω—É—é –ø–æ —á–µ–∫–ª–∏—Å—Ç—É –∏–∑ e2e-test-plan.md)
- [ ] –ö–æ–º–º–∏—Ç —Å –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
- [ ] Baseline —Ç–∞–±–ª–∏—Ü–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (–µ—Å–ª–∏ –ø–æ—è–≤–∏–ª–∏—Å—å –Ω–æ–≤—ã–µ —Ç–µ—Å—Ç—ã)
